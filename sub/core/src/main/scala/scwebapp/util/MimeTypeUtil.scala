package scwebapp.util

import java.util.Locale

import scutil.implicits._

import scwebapp.data.MimeType

/*
// NOTE gives the right type for images with uppercase name extensions
// @see http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7142921
private def mimeType(file:File):MimeType	=
		Option(Files probeContentType file.toPath) flatMap MimeType.parse getOrElse application_octetStream
*/
object MimeTypeUtil {
	def forFileName(it:String):Option[MimeType]	=
			extension(it) flatMap forExtension
	
    def forExtension(it:String):Option[MimeType]	=
       		types get it flatMap MimeType.parse

    private def extension(it:String):Option[String]	=
    	    it lastIndexOf "." guardBy { _ !=== -1 } map { idx => it substring idx+1 toLowerCase Locale.US }
	
    private val types = Map(
         // @see software/java/apache-tomcat-6.0.14-src/java/org/apache/tomcat/util/http/MimeMap.java
		"txt"			-> "text/plain",
		"html"			-> "text/html",
		"htm"			-> "text/html",
		"gif"			-> "image/gif",
		"jpg"			-> "image/jpeg",
		"jpe"			-> "image/jpeg",
		"jpeg"			-> "image/jpeg",
		"png"			-> "image/png",
		"java"			-> "text/plain",
		"body"			-> "text/html",
		"rtx"			-> "text/richtext",
		"tsv"			-> "text/tab-separated-values",
		"etx"			-> "text/x-setext",
		//"ps"			-> "application/x-postscript",
		"class"			-> "application/java",
		"csh"			-> "application/x-csh",
		"sh"			-> "application/x-sh",
		"tcl"			-> "application/x-tcl",
		"tex"			-> "application/x-tex",
		"texinfo"		-> "application/x-texinfo",
		"texi"			-> "application/x-texinfo",
		"t"				-> "application/x-troff",
		"tr"			-> "application/x-troff",
		"roff"			-> "application/x-troff",
		"man"			-> "application/x-troff-man",
		"me"			-> "application/x-troff-me",
		"ms"			-> "application/x-wais-source",
		"src"			-> "application/x-wais-source",
		"zip"			-> "application/zip",
		"bcpio"			-> "application/x-bcpio",
		"cpio"			-> "application/x-cpio",
		"gtar"			-> "application/x-gtar",
		"shar"			-> "application/x-shar",
		"sv4cpio"		-> "application/x-sv4cpio",
		"sv4crc"		-> "application/x-sv4crc",
		"tar"			-> "application/x-tar",
		"ustar"			-> "application/x-ustar",
		"dvi"			-> "application/x-dvi",
		"hdf"			-> "application/x-hdf",
		"latex"			-> "application/x-latex",
		"bin"			-> "application/octet-stream",
		"oda"			-> "application/oda",
		"pdf"			-> "application/pdf",
		"ps"			-> "application/postscript",
		"eps"			-> "application/postscript",
		"ai"			-> "application/postscript",
		"rtf"			-> "application/rtf",
		"nc"			-> "application/x-netcdf",
		"cdf"			-> "application/x-netcdf",
		"cer"			-> "application/x-x509-ca-cert",
		"exe"			-> "application/octet-stream",
		"gz"			-> "application/x-gzip",
		"Z"				-> "application/x-compress",
		"z"				-> "application/x-compress",
		"hqx"			-> "application/mac-binhex40",
		"mif"			-> "application/x-mif",
		"ief"			-> "image/ief",
		"tiff"			-> "image/tiff",
		"tif"			-> "image/tiff",
		"ras"			-> "image/x-cmu-raster",
		"pnm"			-> "image/x-portable-anymap",
		"pbm"			-> "image/x-portable-bitmap",
		"pgm"			-> "image/x-portable-graymap",
		"ppm"			-> "image/x-portable-pixmap",
		"rgb"			-> "image/x-rgb",
		"xbm"			-> "image/x-xbitmap",
		"xpm"			-> "image/x-xpixmap",
		"xwd"			-> "image/x-xwindowdump",
		"au"			-> "audio/basic",
		"snd"			-> "audio/basic",
		"aif"			-> "audio/x-aiff",
		"aiff"			-> "audio/x-aiff",
		"aifc"			-> "audio/x-aiff",
		"wav"			-> "audio/x-wav",
		"mpeg"			-> "video/mpeg",
		"mpg"			-> "video/mpeg",
		"mpe"			-> "video/mpeg",
		"qt"			-> "video/quicktime",
		"mov"			-> "video/quicktime",
		"avi"			-> "video/x-msvideo",
		"movie"			-> "video/x-sgi-movie",
		"avx"			-> "video/x-rad-screenplay",
		"wrl"			-> "x-world/x-vrml",
		"mpv2"			-> "video/mpeg2",
		"xml"			-> "text/xml",
		"xsl"			-> "text/xml",
		"svg"			-> "image/svg+xml",
		"svgz"			-> "image/svg+xml",
		"wbmp"			-> "image/vnd.wap.wbmp",
		"wml"			-> "text/vnd.wap.wml",
		"wmlc"			-> "application/vnd.wap.wmlc",
		"wmls"			-> "text/vnd.wap.wmlscript",
		"wmlscriptc"	-> "application/vnd.wap.wmlscriptc",
		
        //@see software/java/apache-tomcat-6.0.14-src/conf/web.xml
        "abs"			-> "audio/x-mpeg",
        "ai"			-> "application/postscript",
        "aif"			-> "audio/x-aiff",
        "aifc"			-> "audio/x-aiff",
        "aiff"			-> "audio/x-aiff",
        "aim"			-> "application/x-aim",
        "art"			-> "image/x-jg",
        "asf"			-> "video/x-ms-asf",
        "asx"			-> "video/x-ms-asf",
        "au"			-> "audio/basic",
        "avi"			-> "video/x-msvideo",
        "avx"			-> "video/x-rad-screenplay",
        "bcpio"			-> "application/x-bcpio",
        "bin"			-> "application/octet-stream",
        "bmp"			-> "image/bmp",
        "body"			-> "text/html",
        "cdf"			-> "application/x-cdf",
        "cer"			-> "application/x-x509-ca-cert",
        "class"			-> "application/java",
        "cpio"			-> "application/x-cpio",
        "csh"			-> "application/x-csh",
        "css"			-> "text/css",
        "dib"			-> "image/bmp",
        "doc"			-> "application/msword",
        "dtd"			-> "application/xml-dtd",
        "dv"			-> "video/x-dv",
        "dvi"			-> "application/x-dvi",
        "eps"			-> "application/postscript",
        "etx"			-> "text/x-setext",
        "exe"			-> "application/octet-stream",
        "gif"			-> "image/gif",
        "gtar"			-> "application/x-gtar",
        "gz"			-> "application/x-gzip",
        "hdf"			-> "application/x-hdf",
        "hqx"			-> "application/mac-binhex40",
        "htc"			-> "text/x-component",
        "htm"			-> "text/html",
        "html"			-> "text/html",
        "hqx"			-> "application/mac-binhex40",
        "ief"			-> "image/ief",
        "jad"			-> "text/vnd.sun.j2me.app-descriptor",
        "jar"			-> "application/java-archive",
        "java"			-> "text/plain",
        "jnlp"			-> "application/x-java-jnlp-file",
        "jpe"			-> "image/jpeg",
        "jpeg"			-> "image/jpeg",
        "jpg"			-> "image/jpeg",
        "js"			-> "text/javascript",
        "jsf"			-> "text/plain",
        "jspf"			-> "text/plain",
        "kar"			-> "audio/x-midi",
        "latex"			-> "application/x-latex",
        "m3u"			-> "audio/x-mpegurl",
        "mac"			-> "image/x-macpaint",
        "man"			-> "application/x-troff-man",
        "mathml"		-> "application/mathml+xml",
        "me"			-> "application/x-troff-me",
        "mid"			-> "audio/x-midi",
        "midi"			-> "audio/x-midi",
        "mif"			-> "application/x-mif",
        "mov"			-> "video/quicktime",
        "movie"			-> "video/x-sgi-movie",
        "mp1"			-> "audio/x-mpeg",
        "mp2"			-> "audio/x-mpeg",
        "mp3"			-> "audio/x-mpeg",
        "mp4"			-> "video/mp4",
        "mpa"			-> "audio/x-mpeg",
        "mpe"			-> "video/mpeg",
        "mpeg"			-> "video/mpeg",
        "mpega"			-> "audio/x-mpeg",
        "mpg"			-> "video/mpeg",
        "mpv2"			-> "video/mpeg2",
        "ms"			-> "application/x-wais-source",
        "nc"			-> "application/x-netcdf",
        "oda"			-> "application/oda",
        "odb"			-> "application/vnd.oasis.opendocument.database",
        "odc"			-> "application/vnd.oasis.opendocument.chart",
        "odf"			-> "application/vnd.oasis.opendocument.formula",
        "odg"			-> "application/vnd.oasis.opendocument.graphics",
        "odi"			-> "application/vnd.oasis.opendocument.image",
        "odm"			-> "application/vnd.oasis.opendocument.text-master",
        "odp"			-> "application/vnd.oasis.opendocument.presentation",
        "ods"			-> "application/vnd.oasis.opendocument.spreadsheet",
        "odt"			-> "application/vnd.oasis.opendocument.text",
        "ogg"			-> "application/ogg",
        "otg "			-> "application/vnd.oasis.opendocument.graphics-template",
        "oth"			-> "application/vnd.oasis.opendocument.text-web",
        "otp"			-> "application/vnd.oasis.opendocument.presentation-template",
        "ots"			-> "application/vnd.oasis.opendocument.spreadsheet-template ",
        "ott"			-> "application/vnd.oasis.opendocument.text-template",
        "pbm"			-> "image/x-portable-bitmap",
        "pct"			-> "image/pict",
        "pdf"			-> "application/pdf",
        "pgm"			-> "image/x-portable-graymap",
        "pic"			-> "image/pict",
        "pict"			-> "image/pict",
        "pls"			-> "audio/x-scpls",
        "png"			-> "image/png",
        "pnm"			-> "image/x-portable-anymap",
        "pnt"			-> "image/x-macpaint",
        "ppm"			-> "image/x-portable-pixmap",
        "ppt"			-> "application/powerpoint",
        "ps"			-> "application/postscript",
        "psd"			-> "image/x-photoshop",
        "qt"			-> "video/quicktime",
        "qti"			-> "image/x-quicktime",
        "qtif"			-> "image/x-quicktime",
        "ras"			-> "image/x-cmu-raster",
        "rdf"			-> "application/rdf+xml",
        "rgb"			-> "image/x-rgb",
        "rm"			-> "application/vnd.rn-realmedia",
        "roff"			-> "application/x-troff",
        "rtf"			-> "application/rtf",
        "rtx"			-> "text/richtext",
        "sh"			-> "application/x-sh",
        "shar"			-> "application/x-shar",
        "smf"			-> "audio/x-midi",
        "sit"			-> "application/x-stuffit",
        "snd"			-> "audio/basic",
        "src"			-> "application/x-wais-source",
        "sv4cpio"		-> "application/x-sv4cpio",
        "sv4crc"		-> "application/x-sv4crc",
        "swf"			-> "application/x-shockwave-flash",
        "t"				-> "application/x-troff",
        "tar"			-> "application/x-tar",
        "tcl"			-> "application/x-tcl",
        "tex"			-> "application/x-tex",
        "texi"			-> "application/x-texinfo",
        "texinfo"			-> "application/x-texinfo",
        "tif"			-> "image/tiff",
        "tiff"			-> "image/tiff",
        "tr"			-> "application/x-troff",
        "tsv"			-> "text/tab-separated-values",
        "txt"			-> "text/plain",
        "ulw"			-> "audio/basic",
        "ustar"			-> "application/x-ustar",
        "vxml"			-> "application/voicexml+xml",
        "xbm"			-> "image/x-xbitmap",
        "xht"			-> "application/xhtml+xml",
        "xhtml"			-> "application/xhtml+xml",
        "xml"			-> "application/xml",
        "xpm"			-> "image/x-xpixmap",
        "xsl"			-> "application/xml",
        "xslt"			-> "application/xslt+xml",
        "xul"			-> "application/vnd.mozilla.xul+xml",
        "xwd"			-> "image/x-xwindowdump",
        "wav"			-> "audio/x-wav",
        "svg"			-> "image/svg+xml",
        "svgz"			-> "image/svg+xml",
        "vsd"			-> "application/x-visio",
        "wbmp"			-> "image/vnd.wap.wbmp",
        "wml"			-> "text/vnd.wap.wml",
        "wmlc"			-> "application/vnd.wap.wmlc",
        "wmls"			-> "text/vnd.wap.wmlscript",
        "wmlscriptc"	-> "application/vnd.wap.wmlscriptc",
        "wmv"			-> "video/x-ms-wmv",
        "wrl"			-> "x-world/x-vrml",
        "Z"				-> "application/x-compress",
        "z"				-> "application/x-compress",
        "zip"			-> "application/zip",
        "xls"			-> "application/vnd.ms-excel",
        "doc"			-> "application/vnd.ms-word",
        "ppt"			-> "application/vnd.ms-powerpoint"
	)
}
